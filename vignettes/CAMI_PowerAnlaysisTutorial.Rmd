---
title: "CAMI power analysis "
author: "Megan Ruffley"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{CAMI tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
## Community Assembly Model Inference

### Installation
We will begin by installing **devtools**. Devtools is an R package that enables the development of other R packages. You can use devtools to install a package that is managed in a github repository. We will install CAMI this way. 

```{r message=FALSE}
#install.packages("devtools")
#require(devtools)
#devtools::install_github("ruffleymr/CAMI")
require("CAMI")
require("randomForest")
require("abc")

```

### Simulation of Data

We will simulate the community assembly data using the function _SimCommunityAssembly_. The function first simulates a regional community phylogeny and traits on that phylogeny. Then, using that information, the local community is assembled by either neutral, habitat filtering, or compeitive exclusion processes. 

For the power analysis, there are two elements we want to check out. The first being whether or not randomForest and ABC are able to classify the simulated community data as genertated by correct model. The other is whether or not the amount of data contribute to the power of the analysis, i.e. does more data ensure that the correct model is selected more often. We will address both of these questions. 

```{r message=FALSE, results='hide'}

#We will simulate under varying sizes of regional communities, these numbers set the lower bounds for simulations
sample.sizes <- c(100,200,300,400,500,600,700,800,900)

for (i in 1:3) {
  reg.com.size <- c(sample.sizes[i], sample.sizes[i]+100)
  sims <- 100
  
  #BM models
  BM.neutral <- SimCommunityAssembly(sims = sims, N = reg.com.size, local = 0.5, traitsim = "BM", comsim = "neutral")
  BM.filtering <- SimCommunityAssembly(sims = sims, N = reg.com.size, local = 0.5, traitsim = "BM", comsim = "filtering")
  BM.competition <- SimCommunityAssembly(sims = sims, N = reg.com.size, local = 0.5, traitsim = "BM", comsim = "competition")
  
  #OU models
  OU.neutral <- SimCommunityAssembly(sims = sims, N = reg.com.size, local = 0.5, traitsim = "OU", comsim = "neutral")
  OU.filtering <- SimCommunityAssembly(sims = sims, N = reg.com.size, local = 0.5, traitsim = "OU", comsim = "filtering")
  OU.competition <- SimCommunityAssembly(sims = sims, N = reg.com.size, local = 0.5, traitsim = "OU", comsim = "competition")
  
  All.Summ.Stats <- rbind(BM.neutral$summary.stats, BM.filtering$summary.stats, BM.competition$summary.stats,
                          OU.neutral$summary.stats, OU.filtering$summary.stats, OU.competition$summary.stats)
  Model.Index <- rep(c("BMneut", "BMfilt", "BMcomp", "OUneut", "OUfilt", "OUcomp"), each = sims)
  
  Ref.Table <- data.frame(All.Summ.Stats, Model.Index)
}


rf <- randomForest(Model.Index ~., data=Ref.Table, ntree=500, importance=T)
rf
```
